"use strict";const i=require("electron"),c=require("fs/promises"),a=require("path");process.env.DIST=a.join(__dirname,"../dist");process.env.VITE_PUBLIC=i.app.isPackaged?process.env.DIST:a.join(__dirname,"../public");let o;const s=process.env.VITE_DEV_SERVER_URL;function d(){const n=a.join(__dirname,"preload.js");console.error("[Main] Preload path:",n),o=new i.BrowserWindow({width:1200,height:800,minWidth:800,minHeight:600,icon:a.join(process.env.VITE_PUBLIC??__dirname,"electron-vite.svg"),backgroundColor:"#fbf7ef",frame:!1,autoHideMenuBar:!0,titleBarStyle:"hidden",webPreferences:{preload:n,nodeIntegration:!0,contextIsolation:!1,webSecurity:!1}}),s?o.loadURL(s):o.loadFile(a.join(process.env.DIST,"index.html")),i.ipcMain.on("window:minimize",()=>o?.minimize()),i.ipcMain.on("window:maximize",()=>{o?.isMaximized()?o.unmaximize():o?.maximize()}),i.ipcMain.on("window:close",()=>o?.close())}i.ipcMain.handle("dialog:openDirectory",async()=>{console.log("[Main] Opening directory dialog...");try{const{canceled:n,filePaths:e}=await i.dialog.showOpenDialog({properties:["openDirectory"],title:"Select Project Folder",buttonLabel:"Open Project"});return n?(console.log("[Main] Dialog canceled"),null):(console.log("[Main] Selected path:",e[0]),e[0])}catch(n){throw console.error("[Main] Dialog Error:",n),n}});i.ipcMain.handle("fs:readDirectory",async(n,e)=>{console.log("[Main] Reading directory:",e);try{return await c.access(e),(await c.readdir(e,{withFileTypes:!0})).map(r=>({name:r.name,isDirectory:r.isDirectory(),path:a.join(e,r.name)})).sort((r,l)=>r.isDirectory===l.isDirectory?0:r.isDirectory?-1:1)}catch(t){throw console.error("[Main] ReadDir Error:",t),t}});i.ipcMain.handle("fs:readFile",async(n,e)=>(console.log("[Main] Reading file:",e),await c.readFile(e,"utf-8")));i.ipcMain.handle("fs:writeFile",async(n,e,t)=>(console.log("[Main] Writing file:",e),await c.writeFile(e,t,"utf-8"),!0));i.app.on("window-all-closed",()=>{process.platform!=="darwin"&&i.app.quit()});i.app.whenReady().then(d);
